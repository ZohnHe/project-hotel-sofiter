<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

    <title></title>

    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="This is my page">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <!--   <link rel="stylesheet" href="/static/css/roomset/roomset.css" type="text/css"></link> -->
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.css" type="text/css"></link>
    <link rel="stylesheet" href="/static/css/page.css" type="text/css"></link>
    <link href="/static/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">  <!-- start 响应式布局要添加的 -->
    <link rel="stylesheet" href="/static/css/amazeui.min.css" type="text/css"></link>
    <!--分页插件CSS-->
    <link href="http://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="http://cdn.bootcss.com/datatables/1.10.11/css/dataTables.bootstrap.min.css" rel="stylesheet"
          media="screen">
    <link href="http://cdn.bootcss.com/datatables/1.10.11/css/jquery.dataTables.min.css" rel="stylesheet"
          media="screen">
    <script src="/static/bootstrap/js/jquery-3.1.1.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript" src="/static/js/page.js"></script>
    <script type="text/javascript" src="/static/js/layer/layer.js"></script>
    <script type="text/javascript" src="/static/js/amazeui.min.js"></script>

    <style>

        .container {
            margin-top: 10px;
        }

        .labelroomnumber {
            position: relative;
            font-size: 17px;
            float: left;
            margin-top: 15px;
        }

        .textone {
            margin-top: 12px;
        }

        .rightOne {
            margin-right: 50px;
            font-size: 16px;
        }

        .table th, .table td {
            text-align: center;
        }

        .theadone {
            background-color: #CCFF99;
        }

        .dgvone {
            margin-top: 12px;
        }

        .roomnumberwidth {
            width: 70%;
        }


    </style>

</head>

<body>
<div class="container">
    <!--搜索-->
    <div class="span4">
        <div class="row-fluid">
            <label class="labelroomnumber" style="font-size:16px;">商品名：</label>
            <form action="" method="post" style="float: left;">
                <input id="txtnameid" name="txtname" class="textone roomnumberwidth"
                       style="border-radius:0px; border-top-left-radius:4px; border-bottom-left-radius:4px;height:27px;"
                       type="text" placeholder="请输入关键字" value="">
                <div class="input-append">
                    <button type="button" onclick="selectFunction()" class="btn btn-success  btn-small textone"
                            style="margin-left:-5px;height:27px;">
                        <li class="icon-search icon-white"></li>
                        搜索
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div class="span6">
        <div class="row-fluid">
            <!-- 商品类别 -->
            <div class="span5">
                <select id="selectCboId" name="commodityTypeID" class="dgvone" style="width:80%;">
                    <option value="15" selected="selected">
                        餐饮类
                    </option>
                    <option value="16">
                        饮料类
                    </option>
                    <option value="17">
                        食品类
                    </option>
                    <option value="18">
                        烟酒类
                    </option>
                    <option value="19">
                        人为损坏类
                    </option>
                    <option value="20">
                        其他
                    </option>
                </select>
                <!-- 加号-->
              <!--  <button id="" class="textone"
                        data-am-modal="{target: '#doc-modal-1', closeViaDimmer: 0, width: 300, height: 600}">
                    <li class="icon-plus"></li>
                </button>-->
            </div>
            <div class="span2">
                <button class="btn btn-info btn-small textone" type="button" id="addNew">
                    <li class="icon-plus icon-white"></li>
                    新增
                </button>
            </div>
            <div class="span2">
                <button class="btn btn-warning btn-small textone" type="button" id="updateid">
                    <li class="icon-pencil icon-white"></li>
                    修改
                </button>
            </div>
            <div class="span2">
                <button class="btn btn-danger btn-small textone" type="button" id="deleteId">
                    <li class="icon-remove icon-white"></li>
                    删除
                </button>
            </div>

        </div>
    </div>
    <br>
    <div class="dgvone">
        <table class="table table-condensed table-bordered table-striped" id="tableid">
            <thead class="theadone">
            <tr>
                <th>选择</th>
                <th>商品名称</th>
                <th>商品类别</th>
                <th>计量单位</th>
                <th>销售价格</th>
            </tr>
            </thead>
        </table>
    </div>
    <div class="span11">
        <div class="row-fluid">
            <div class="tcdPageCode" style="text-align:center;"></div>
        </div>
    </div>
</div>
<!--<div class="am-modal am-modal-no-btn" tabindex="-1" id="doc-modal-1">
    <div style="background:#fff" class="am-modal-dialog">
        <div style="background:#0e90d2; color: #fff" class="am-modal-hd">商品类别操作
            <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
        </div>
        &lt;!&ndash; 内容 &ndash;&gt;
        <div>
            <div class="container">
                <div class="span3">
                    <div class="span4">
                        <div class="row-fluid">
                            <label id="bie" class="labelroomnumber"
                                   style="margin-left: -20px; font-size: 15px;">商品名：</label>
                            <form action="" method="post" style="float: left;">
                                <input id="newtxtnameid" type="text" placeholder="请输入要新增的商品名称"
                                       style="width:120%;height: 26px;margin-top: 11px;">
                            </form>
                        </div>
                    </div>
                    <div>
                        <button style="margin-top:-23px;" class="btn btn-info btn-small" type="button"
                                onclick="newaddfunction()">
                            <li class="icon-plus icon-white"></li>
                            新增
                        </button>

                        <button style="margin-top:-23px;" class="btn btn-danger btn-small" type="button"
                                onclick="newdeletefunction()">
                            <li class="icon-remove icon-white"></li>
                            删除
                        </button>
                    </div>
                    <br>
                    <div class="dgvone" style="margin-top:-18px;width:267px;height:443px;overflow:scroll;">
                        <table class="table table-condensed table-bordered table-striped" id="tableid2"
                               style="width: 250px;height: 20px;">
                            <thead class="theadone">
                            <tr>
                                <th rowspan="2">选择</th>
                                <th rowspan="2">商品名称</th>
                            </thead>
                            <tbody id="tbody">

                            </tbody>
                        </table>
                    </div>
                </div>

                <div/>
                &lt;!&ndash; 内容 &ndash;&gt;
                <div/>
            </div>
            <div/>
        </div>
    </div>
</div>-->
<!--分页插件JS-->
<script src="http://cdn.bootcss.com/datatables/1.10.11/js/jquery.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="http://cdn.bootcss.com/datatables/1.10.11/js/jquery.dataTables.min.js"></script>
<script src="http://cdn.bootcss.com/datatables/1.10.11/js/dataTables.bootstrap.min.js"></script>
<script type="text/javascript">
    $(function () {
        /* 商品类别切换,点击事件 */
        var commodityTypeID = 15;
        $("#selectCboId").change(function () {
            commodityTypeID = $("#selectCboId").val();
            //alert(commodityTypeID)
            /* 刷新 */
            table.draw(false);
            return
        });
        //提示信息
        var lang = {
            "sProcessing": "处理中...",
            "sLengthMenu": "每页 _MENU_ 项",
            "sZeroRecords": "没有匹配结果",
            "sInfo": "当前显示第 _START_ 至 _END_ 项，共 _TOTAL_ 项。",
            "sInfoEmpty": "当前显示第 0 至 0 项，共 0 项",
            "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
            "sInfoPostFix": "",
            "sSearch": "搜索:",
            "sUrl": "",
            "sEmptyTable": "表中数据为空",
            "sLoadingRecords": "载入中...",
            "sInfoThousands": ",",
            "oPaginate": {
                "sFirst": "首页",
                "sPrevious": "上页",
                "sNext": "下页",
                "sLast": "末页",
                "sJump": "跳转"
            },
            "oAria": {
                "sSortAscending": ": 以升序排列此列",
                "sSortDescending": ": 以降序排列此列"
            }
        };

        //初始化表格
        var table = $("#tableid").dataTable({
            language: lang,  //提示信息
            autoWidth: false,  //禁用自动调整列宽
            stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
            processing: true,  //隐藏加载提示,自行处理
            serverSide: true,  //启用服务器端分页
            searching: false,  //禁用原生搜索
            orderMulti: false,  //启用多列排序
            order: [],  //取消默认排序查询,否则复选框一列会出现小箭头
            renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
            pagingType: "simple_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
            //渲染
            columnDefs: [{
                "render": function (data, type, row) {
                    return "<input type='checkbox' name='goodsId' value='" + data + "'>";
                },
                "targets": 0 //指定渲染列：第一列(渲染第一列为单选框，data自动匹配为  {"data":"id"}中数据）
            }, {
                "targets": 'nosort',  //列的样式名
                "orderable": false    //包含上样式名‘nosort’的禁止排序
            }],
            ajax: function (data, callback, settings) {
                //封装请求参数
                var param = {};
                param.pageSize = data.length;//页面显示记录条数，在页面显示每页显示多少项的时候
                // param.start = data.start;//开始的记录序号
                param.pageNum = (data.start / data.length) + 1;//当前页码
                param.commodityTypeID = commodityTypeID;
                //console.log(param);
                //ajax请求数据
                $.ajax({
                    type: "POST",
                    url: "/commodity/tolist",
                    contentType: "application/json; charset=utf-8",
                    cache: false,  //禁用缓存
                    data: JSON.stringify(param),  //传入组装的参数
                    dataType: "json",
                    success: function (data) {
                        //setTimeout仅为测试延迟效果
                        setTimeout(function () {
                            //封装返回数据
                            var returnData = {};
                            returnData.draw = data.draw;//这里直接自行返回了draw计数器,应该由后台返回
                            returnData.recordsTotal = data.totalRecord;//返回数据全部记录
                            returnData.recordsFiltered = data.totalRecord;//后台不实现过滤功能，每次查询均视作全部结果
                            returnData.data = data.data;//返回的数据列表
                            //console.log(returnData);
                            //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                            //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                            callback(returnData);
                        }, 200);
                    }
                });
            },
            //列表表头字段
            columns: [
                {"data": "id"},
                {"data": "commodityName"},
                {"data": "commodityTypeName"},
                {"data": "uOMName"},
                {"data": "salePrice"}
            ]
        }).api();
        //此处需调用api()方法,否则返回的是JQuery对象而不是DataTables的API对象
    });
    /* 页面跳转,需要跟mian首页一起打开 */
    $(function () {
        $("#addNew").click(function () {
            /* 把地址赋值给mian首页的src,进行跳转 */
            parent.document.getElementById('Mainid').src = '/static/html/commodity/add.html';
        })
    })

    /* 删除点击事件 */
    $(function () {
        $("#deleteId").click(function () {
            var chk_value = [];
            /* 找input这个标签中name="goodsId",checked选择的,遍历加入数组 */
            /* 用分页插件也行,找到对应的name */
            $('input[name="goodsId"]:checked').each(function () {
                /* 添加值 */
                chk_value.push($(this).val());
            });
            if (chk_value != "") {
                var flag = window.confirm("注意：您确定要永久删除该信息吗?");
                if (flag) {
                    /* 封装请求参数 */
                    var param = {};
                    param.deleteIds = chk_value;
                    $.ajax({
                        type: "POST",
                        url: "/commodity/delete",
                        contentType: "application/json; charset=utf-8",
                        cache: false,  //禁用缓存
                        data: JSON.stringify(param),  //传入组装的参数
                        dataType: "json",
                        success: function (result) {
                            if (result.result >= 1) {
                                alert("删除成功");
                            } else {
                                alert("删除失败!");
                            }
                        }
                    });
                    /* 加载整个页面 */
                    location.reload()
                }
            } else {
                alert("请选择一条或多条数据进行删除");
            }
        })
    })

    /* 修改点击事件 */
    /* $(function () {
         $("#updateid").click(function () {
             debugger
             var chk_value = [];
             /!* 找input这个标签中name="goodsId",checked选择的,遍历加入数组 *!/
             /!* 用分页插件也行,找到对应的name *!/
             $('input[name="goodsId"]:checked').each(function () {
                 chk_value.push($(this).val());
                 /!* 获取表格行数 *!/
                 selectedIndex = this.parentNode.parentNode.rowIndex;
                 /!* cells[1] 是表格第一列,表格是有0列 *!/
                 commodityName = table.rows[selectedIndex].cells[1].innerHTML;
                 commodityType = table.rows[selectedIndex].cells[1 + 1].innerHTML;
                 oUMID = table.rows[selectedIndex].cells[1 + 2].innerHTML;
                 SalePrice = table.rows[selectedIndex].cells[1 + 3].innerHTML;
             });
             /!* alert(chk_value);
                    alert(selectedIndex)
                    alert(commodityName);
                    alert(commodityType);
                    alert(oUMID);
                    alert(SalePrice);*!/
             parent.document.getElementById("Mainid").src = '/static/html/stayregister/register.html?commodityId=' + chk_value + "&commodityName=" + commodityName
                 + "&commodityType=" + commodityType + "&oUMID=" + oUMID + "&SalePrice=" + SalePrice;
             if (chk_value != "") {
                 if (chk_value.length > 1) {
                     alert("抱歉!不支持多选删除")
                     return
                 }else {
                     var flag = window.confirm("注意：您确定要修改该信息吗?");
                     if (flag) {
                         /!* 加载整个页面 *!/
                         parent.document.getElementById('Mainid').src = '/static/html/commodity/update.html?stayRegisterID='+chk_value;
                        // parent.document.getElementById("Mainid").src = '/static/html/commodity/update.html?stayRegisterID='+chk_value+"&roomNumber="+roomNumber;
                     }
                 }
             } else {
                 alert("请选择一条数据进行修改");
             }
         })
     })*/

    $(function () {
        $("#updateid").click(function () {
            var chk_value = [];
            var table = document.getElementById("tableid");
            var commodityName = "";
            var commodityType = "";
            var oUMID = "";
            var SalePrice = "";
            $('input[name="goodsId"]:checked').each(function () {
                chk_value.push($(this).val());
                /* 获取表格行数 */
                selectedIndex = this.parentNode.parentNode.rowIndex;
                commodityName = table.rows[selectedIndex].cells[1].innerHTML;
                commodityType = table.rows[selectedIndex].cells[1 + 1].innerHTML;
                oUMID = table.rows[selectedIndex].cells[1 + 2].innerHTML;
                SalePrice = table.rows[selectedIndex].cells[1 + 3].innerHTML;
                switch (commodityType) {
                    case "餐饮类":
                        commodityType = 15;
                        break;
                    case "饮料类":
                        commodityType = 16
                        break;
                    case "食品类":
                        commodityType = 17
                        break;
                    case "烟酒类":
                        commodityType = 18
                        break;
                    case "人为损坏类":
                        commodityType = 19
                        break;
                    case "其他":
                        commodityType = 20
                        break;
                }
                switch (oUMID) {
                    case "瓶":
                        oUMID = 57;
                        break;
                    case "台":
                        oUMID = 58
                        break;
                    case "条":
                        oUMID = 59
                        break;
                    case "支":
                        oUMID = 60
                        break;
                    case "个":
                        oUMID = 61
                        break;
                    case "只":
                        oUMID = 62
                        break;
                    case "包":
                        oUMID = 63
                        break;
                    case "份":
                        oUMID = 70
                        break;
                    case "碟":
                        oUMID = 71
                        break;
                }
            });
            if (chk_value.length == 0) {
                alert("请选择修改的商品!")
                location.reload()
                return
            }
            if (chk_value.length > 1) {
                alert("抱歉!不支持多选删除")
                location.reload()
                return
            }
            parent.document.getElementById("Mainid").src = '/static/html/commodity/update.html?commodityId=' + chk_value + "&commodityName=" + commodityName + "&commodityType=" + commodityType + "&oUMID=" + oUMID + "&SalePrice=" + SalePrice;
        })
    })
</script>
</body>

</html>
